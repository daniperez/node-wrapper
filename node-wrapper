#!/bin/sh
##########################################################################
#
# node-wrapper script for Unix 
#
##########################################################################
ARCH=$(sed -e 's/i386/86/' -e 's/x86_64/64/'x86)
SO=$(uname -o | sed -e 's/GNU\/Linux/linux/' -e 's/Darwin/darwin/')
NODEJS_VERSION = 0.8.9
NPM_VERSION    = 1.1.9
NODEJS_PREFIX  = "$PWD/.node"
NODEJS_URL     = "http://nodejs.org/dist/v$NODEJS_VERSION/node-v$NODEJS_VERSION-$(OS)-$(ARCH).tar.gz"
NPM_URL        = "http://nodejs.org/dist/npm/npm-$NPM_VERSION.tar.gz"
LOG_FILE       = node-wrapper.log
##########################################################################

echo > $LOG_FILE

_NODE_JS_EXE = "$NODEJS_PREFIX/node-$NODEJS_VERSION"
_NPM_ZIP     = "$NODEJS_PREFIX/npm-$NPM_VERSION.zip"

##########################################################################
# Download nodejs
##########################################################################
if [ ! -x "$_NODE_JS_EXE" ]; then

  echo "Downloading nodejs into $NODEJS_PREFIX (be patient, it can take several minutes)"
  wget  -O "$_NODE_JS_EXE" "$NODEJS_URL" >> "$LOG_FILE"
fi

##########################################################################
# Download npm
##########################################################################
if [ ! -e "$_NPM_ZIP" ]; then

  echo "Downloading npm into $NODEJS_PREFIX (be patient, it can take several minutes)"
  wget  -O "$_NPM_ZIP" "$NPM_VERSION" >> "$LOG_FILE"
fi

echo "Installing npm"
tar xvfz -C "$NODEJS_PREFIX" "$_NPM_ZIP" >> "$LOG_FILE"

echo "Done!"
